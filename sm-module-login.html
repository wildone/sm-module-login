<link rel="import" href="../polymer/polymer.html"> <link rel="import" href="../sm-ui-core/sm-ui-core.html"> <link rel="import" href="../sm-ui-modal/sm-ui-modal.html"> <link rel="import" href="../sm-ui-button/sm-ui-button.html"> <dom-module id="sm-module-login"> <template> <style include="sm-css-shady"></style> <style include="sm-css"></style> <style>:root{--modal-width:350px}:host{@apply(--typography);text-align:center;position:relative;z-index:var(--on-top)}.login__form__input{display:inline-block;text-align:center;width:85%;font-size:18px;margin:16px auto;padding:8px 0;border-radius:var(--border-radius);overflow:auto;color:var(--text-color)}.login__form__input:first-child{margin-top:0}.login__form__input:focus{border-bottom-color:var(--blue);width:85%}.login__form__submit{dispaly:inline-block;background:var(--blue);font-weight:600;color:#fff;border-radius:var(--border-radius);padding:0 35px;margin:21px auto 0;-webkit-transition:color 80ms ease;transition:color 80ms ease}.login__form__submit[busy]{color:var(--med-white)}.login__form__submit--target{display:none}.login__error{-webkit-box-align:center;-webkit-align-items:center;-ms-flex-align:center;-ms-grid-row-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;text-align:center;margin:0 auto;max-width:220px;font-size:15px;color:var(--red);opacity:0;height:0;overflow:visible;display:none}.login__error[visible]{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex}</style> <sm-ui-modal class="login" id="modal" title="Login" no-exit="[[busy]]" on-closed="_handleModalClosed" active="[[active]]"> <form on-submit="login" class="login__form" id="form"> <input id="email" class="login__form__input" value="{{email::input}}" type="text" placeholder="Enter your email"> <input id="password" class="login__form__input" value="{{password::input}}" type="password" placeholder="Enter your password"> <div id="error" class="login__error">[[errorMessage]]</div> <button is="sm-ui-button" type="submit" on-tap="login" id="submit" class="login__form__submit" busy="[[busy]]">let&apos;s go</button> <input type="submit" class="login__form__submit--target"> </form> </sm-ui-modal> </template> <script>!function(){"use strict";function e(e){var r=(new Date).getTime()/1e3,n=void 0;if(!e)return!1;try{var o=e.split("."),a=t.slicedToArray(o,2),s=a[1];n=JSON.parse(atob(s))}catch(l){return console.warn("Invalid token",l.message),!1}return n.exp&&r>n.exp?!1:!(!n.iss||n.iss!==i)}var t={};t.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t.createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),t.slicedToArray=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(l){o=!0,a=l}finally{try{!n&&s["return"]&&s["return"]()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var r=simpla._constants.easings,n="12px",o={401:"Wrong username or pasword",500:"Something has gone wrong on our servers"},a={observers:["_triggerError(error)"],_triggerError:function(e){e?this._triggerErrorOpen():this._triggerErrorClose()},get _errorAnimations(){return{modal:{target:this.$.modal.getModal(),frames:[{transform:"translateX(0)"},{transform:"translateX(-"+n+")"},{transform:"translateX(0)"},{transform:"translateX("+n+")"},{transform:"translateX(0)"}],opts:{easing:"linear",duration:145,iterations:2}},error:{target:this.$.error,frames:[{opacity:0,height:0},{opacity:1,height:"55px"}],opts:{easing:r.easeOutCubic,fill:"both",duration:140,delay:80}}}},_triggerErrorOpen:function(){var e=this,t=this._errorAnimations.modal,r=this._errorAnimations.error,n=void 0;n=t.target.animate(t.frames,t.opts),n.onfinish=function(){e.errorMessage=o[e._errorCode||500],e.toggleAttribute("visible",!0,e.$.error),r.target.animate(r.frames,r.opts)}},_triggerErrorClose:function(){var e=this,t=this._errorAnimations.error,r=t.target,n=t.frames,o=t.opts,a=void 0;a=r.animate(n.reverse(),o),a.onfinish=function(){e.toggleAttribute("visible",!1,r),e.errorMessage=""}}},i="https://simpla.auth0.com/",s="sm-token",l={properties:{token:{type:String,observer:"_setTokenInStorage"}},ready:function(){var t=this,r=void 0;Simpla.observe("token",function(e){return t.token=e});try{r=window.localStorage.getItem(s)}catch(n){r=!1,console.log("Could not load login token from storage. Are you in Private Mode?")}if(e(r))Simpla._store.dispatch({type:"login-successful",response:r});else try{window.localStorage.removeItem(s)}catch(n){console.warn("Could not remember login token. Are you in Private Mode?")}},_setTokenInStorage:function(e){if(e)try{window.localStorage.setItem(s,e)}catch(t){console.warn("Could not remember login token. Are you in Private Mode?")}else try{window.localStorage.removeItem(s)}catch(t){console.warn("Could not logout. Are you in Private Mode?")}}},u=function(){function e(){t.classCallCheck(this,e)}return t.createClass(e,[{key:"beforeRegister",value:function(){this.is="sm-module-login",this.properties={error:Boolean,busy:{type:Boolean,observer:"_busyChanged"},email:String,password:String,active:{type:Boolean,observer:"_activeChanged",computed:"_computeActive(_editing, _authenticated)"},_errorCode:Number,_authenticated:{type:Boolean,observer:"_authenticationChanged",value:Simpla.getState().authenticated},_editing:{type:Boolean,value:Simpla.getState().editing}}}},{key:"created",value:function(){var e=this;Simpla.observe("authenticated",function(t){e._authenticated=t}),Simpla.observe("editing",function(t){e._editing=t})}},{key:"detached",value:function(){this.email="",this.password=""}},{key:"login",value:function(e){var t=this;return e&&e.preventDefault(),this.busy=!0,Simpla.login({email:this.email,password:this.password})["catch"](function(e){return t._handleError(e)}).then(function(){return t.busy=!1})}},{key:"_handleError",value:function(e){this.error=!0,this._errorCode=e.code}},{key:"_authenticationChanged",value:function(e){e&&(this.error=!1)}},{key:"_busyChanged",value:function(e){e&&(this.error=!1)}},{key:"_computeActive",value:function(e,t){return e&&!t}},{key:"_handleModalClosed",value:function(){!this._authenticated&&this.active&&Simpla.toggleEditing(!1)}},{key:"_activeChanged",value:function(e){e&&(this.hidden=!1)}},{key:"behaviors",get:function(){return[a,l]}}]),e}();Polymer(u);var c=document.createElement("sm-module-login"),d=void 0;c.setAttribute("hidden",""),d=function(){return document.body?(document.body.appendChild(c),document.removeEventListener("readystatechange",d),!0):!1},d()||document.addEventListener("readystatechange",d)}()</script> </dom-module>